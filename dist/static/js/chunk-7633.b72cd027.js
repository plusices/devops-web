(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7633","chunk-274f"],{"3ADX":function(t,n,e){"use strict";var o=e("o0o1"),s=e.n(o),i=e("yXPU"),a=e.n(i),c=e("t3Un");function r(t,n){return Object(c.a)({url:t,method:"get",params:n})}n.a={data:function(){return{loading:!0,data:[],page:1,size:10,total:0,url:"",params:{},query:{},time:170}},methods:{init:function(){var t=a()(s.a.mark(function t(){var n=this;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.beforeInit();case 2:if(t.sent){t.next=4;break}return t.abrupt("return");case 4:return t.abrupt("return",new Promise(function(t,e){n.loading=!0,r(n.url,n.params).then(function(e){n.total=e.count,n.data=e.results,setTimeout(function(){n.loading=!1},n.time),t(e)}).catch(function(t){n.loading=!1,e(t)})}));case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),beforeInit:function(){return!0},pageChange:function(t){var n=this;console.log(t),n.page=t,n.$refs.transfer?(console.log("1"),n.cancel(),n.init()):n.$refs.r_table?(console.log("2"),n.init().then(function(){n.initSelection()})):(console.log("3"),console.log(n.page),n.init())},sizeChange:function(t){var n=this;n.page=1,n.size=t,n.$refs.transfer?(console.log("1"),n.cancel(),n.init()):n.$refs.r_table?(console.log("2"),n.init().then(function(){n.initSelection()})):(console.log("3"),n.init())}}}},"41Be":function(t,n,e){"use strict";e.d(n,"a",function(){return s});var o=e("Q2AE");function s(t){if(t&&t instanceof Array&&t.length>0){var n=t;return!!(o.a.getters&&o.a.getters.roles).some(function(t){return n.includes(t)})}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},"8UPv":function(t,n,e){"use strict";var o=e("aqMa");e.n(o).a},Jxl6:function(t,n,e){"use strict";var o=e("uC4E");e.n(o).a},aqMa:function(t,n,e){},bkiL:function(t,n,e){"use strict";e.d(n,"a",function(){return s}),e.d(n,"b",function(){return i});var o=e("t3Un");function s(t){return Object(o.a)({url:"api/ops/ansible/",method:"post",data:t})}function i(t){return Object(o.a)({url:"api/ops/run/playbook/",method:"post",data:t})}},n8TW:function(t,n,e){"use strict";e.r(n);var o=e("oCYn"),s=(e("41Be"),e("bkiL")),i=e("Q2AE"),a=e("3ADX"),c=e("X4fA"),r=e("tAjd"),l=e.n(r),u={mixins:[a.a],data:function(){return{row_data:null,span:24,show:!1,is_permissions:!1,table_show:!0,Loading:!1,sup_this:this,ico:"unlock",unlock:!0,content:"锁定滚动条",height:document.documentElement.clientHeight-480+"px;",width:document.documentElement.clientWidth-225+"px;",startloading:!1,stoploading:!1,servers:"",server_ids:"",hosts:[],data:[],message:i.a.getters.busmsg}},watch:{msg:{handler:function(t,n){var e=this;this.$nextTick(function(){e.data.push("正在执行中......")})}},data:{handler:function(t,n){var e=this;this.$nextTick(function(){if(e.unlock){var t=document.getElementById("console");t.scrollTop=t.scrollHeight}})}}},created:function(){this.init()},mounted:function(){this.initWebSocket(),this.start()},methods:{init:function(){var t=this;window.onresize=function(){t.height=document.documentElement.clientHeight-94.5+"px;"}},prepareExec:function(t){this.data.push("任务"+t+"正在执行中......")},initWebSocket:function(){var t="ws://"+"http://undefined:8000".replace(/http:\/\//,"").replace(/https:\/\//,"")+"/websocket/console?token="+Object(c.a)();console.log(t),o.default.use(l.a,t,{connectManually:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:3e3}),this.vm=new o.default,this.vm.$connect(),console.log("---连接Websocket----")},closeTag:function(){var t=this;this.$confirm("是否关闭页面并返回上一页?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.vm.$disconnect(),t.$router.go(-1),t.$store.dispatch("delView",t.$store.state.tagsView.visitedViews.slice(-1)[0])}).catch(function(){t.$message({type:"info",message:"取消操作"})})},start:function(){var t=this;this.$socket.onopen=function(n){1===n.target.readyState&&(console.log("--------正在读取数据!--------"),t.$socket.onmessage=function(n){t.data.push(n.data),console.log(t.data)})}},startRun:function(){var t=this;this.startloading=!0;var n={exec:"mod_run",hostIds:this.hosts,module:this.cmdForm.module,args:this.cmdForm.args};Object(s.a)(n).then(function(n){t.startloading=!1}).catch(function(n){t.startloading=!1,console.log(n)})},getColor:function(t){var n=t.match(/INFO/i),e=t.match(/WARN/i),o=t.match(/WARNING/i),s=t.match(/DEBUG/i),i=t.match(/\[(.*?)@(.*?)\]/),a=t.match(/ERROR/i),c=t.match(/(.*?[\u4e00-\u9fa5])\[(.*?\d)\]------/);return c&&(this.sequence=parseInt(c[2])),n?t.replace(/INFO/i,'<span style="color: #7FFF00;">'+n+"</span>"):o?t.replace(/WARNING/i,'<span style="color: #FFFF00;">'+o+"</span>"):e?t.replace(/WARN/i,'<span style="color: #FFFF00;">'+e+"</span>"):s?t.replace(/DEBUG/i,'<span style="color: #0000ff;">'+s+"</span>"):i?t.replace(/\[(.*?)@(.*?)\]/,'<span style="color: #FFA54F;">'+i[0]+"</span>"):a?t.replace(/ERROR/i,'<span style="color: #FF0000;">'+a+"</span>"):t},clean:function(){this.ans_result=[],this.data=[],this.$message({showClose:!0,type:"success",message:"清空控制台输出成功！",duration:3500})},resetForm:function(t){this.$refs[t].resetFields()},submitForm:function(t){},doLock:function(){this.unlock?(this.content="解除锁定",this.ico="lock"):(this.content="锁定滚动条",this.ico="unlock"),this.unlock=!this.unlock}}},h=(e("8UPv"),e("KHd+")),f=Object(h.a)(u,function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("el-card",[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("执行结果")])]),t._v(" "),e("div",{staticClass:"console",style:"height:"+t.height,attrs:{id:"console"}},t._l(t.data,function(n){return e("div",{key:n.id},[e("span",{staticClass:"line-html",domProps:{innerHTML:t._s(n)}})])}),0),t._v(" "),e("el-tooltip",{staticClass:"closepage item",attrs:{content:"返回上一页",effect:"dark",placement:"left"}},[e("el-button",{attrs:{type:"info",size:"mini",circle:""},on:{click:t.closeTag}},[e("svg-icon",{attrs:{"icon-class":"return"}})],1)],1),t._v(" "),e("el-tooltip",{staticClass:"clean item",attrs:{content:"清空控制台输出",effect:"dark",placement:"left"}},[e("el-button",{attrs:{type:"info",size:"mini",circle:""},on:{click:t.clean}},[e("svg-icon",{attrs:{"icon-class":"clean"}})],1)],1),t._v(" "),e("el-tooltip",{staticClass:"lock item",attrs:{content:t.content,effect:"dark",placement:"left"}},[e("el-button",{attrs:{type:"info",size:"mini",circle:""},on:{click:t.doLock}},[e("svg-icon",{attrs:{"icon-class":t.ico}})],1)],1)],1)},[],!1,null,null,null);n.default=f.exports},qV3U:function(t,n,e){"use strict";e.r(n);var o={components:{console:e("n8TW").default},data:function(){return{row_data:null,span:24,show:!1,serverIds:[],Loading:!1,sup_this:this,ans_res:[]}}},s=(e("Jxl6"),e("KHd+")),i=Object(s.a)(o,function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"app-container"},[this.show?n("console",{attrs:{query:this.query}}):this._e()],1)},[],!1,null,null,null);n.default=i.exports},uC4E:function(t,n,e){}}]);