(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-9d3a"],{"0smh":function(t,e,n){"use strict";n.r(e);var o=n("oCYn"),i=n("7Qib"),s=n("X4fA"),c=n("Qdvm"),r=n("tAjd"),a=n.n(r),u={data:function(){return{ico:"unlock",unlock:!0,content:"锁定滚动条",height:document.documentElement.clientHeight-94.5+"px;",width:document.documentElement.clientWidth-225+"px;",data:[],vm:null,sequence:1}},watch:{data:{handler:function(t,e){var n=this;this.$nextTick(function(){if(n.unlock){var t=document.getElementById("console");t.scrollTop=t.scrollHeight}})}}},mounted:function(){0===this.$route.query.scenario?this.initWebSocket():this.readLog();var t=this;window.onresize=function(){t.height=document.documentElement.clientHeight-94.5+"px;"}},beforeDestroy:function(){0===this.$route.query.scenario&&(this.vm.$disconnect(this.$route.query.id),console.log("---离开页面关闭Websocket---"))},methods:{parseTime:i.b,initWebSocket:function(){var t=this,e="ws://"+"http://undefined:8000".replace(/http:\/\//,"")+"/websocket/console?token="+Object(s.a)();o.default.use(a.a,e,{connectManually:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:3e3}),this.vm=new o.default,this.vm.$connect(),console.log("---连接Websocket----"),this.$socket.onopen=function(e){1===e.target.readyState&&(console.log("--------等待数据!--------"),t.$socket.onmessage=function(e){var n=t.getColor(e.data);t.data.push(n)}),t.$nextTick(function(){t.start()})}},start:function(){var t={excu:"deploymsg",id:this.$route.query.id,alias:this.$route.query.alias,record:this.$route.query.record,scenario:this.$route.query.scenario};Object(c.c)(t)},readLog:function(){var t=this,e={excu:"readlog",id:this.$route.query.id,alias:this.$route.query.alias,record:this.$route.query.record,scenario:1};Object(c.c)(e).then(function(e){var n=e.split("\n"),o=t;n.forEach(function(t,e){o.data.push(o.getColor(t))})}).catch(function(t){console.log(t)})},closeTag:function(){var t=this;this.$confirm("是否关闭页面并返回上一页?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){0===t.$route.query.scenario&&(t.vm.$disconnect(),console.log("---离开页面关闭Websocket---")),t.$router.go(-1),t.$store.dispatch("delView",t.$store.state.tagsView.visitedViews.slice(-1)[0])}).catch(function(){t.$message({type:"info",message:"取消操作"})})},getColor:function(t){var e=t.match(/INFO/i),n=t.match(/WARN/i),o=t.match(/WARNING/i),i=t.match(/DEBUG/i),s=t.match(/\[(.*?)@(.*?)\]/),c=t.match(/ERROR/i),r=t.match(/(.*?[\u4e00-\u9fa5])\[(.*?\d)\]------/);return r&&(this.sequence=parseInt(r[2])),e?t.replace(/INFO/i,'<span style="color: #7FFF00;">'+e+"</span>"):o?t.replace(/WARNING/i,'<span style="color: #FFFF00;">'+o+"</span>"):n?t.replace(/WARN/i,'<span style="color: #FFFF00;">'+n+"</span>"):i?t.replace(/DEBUG/i,'<span style="color: #0000ff;">'+i+"</span>"):s?t.replace(/\[(.*?)@(.*?)\]/,'<span style="color: #FFA54F;">'+s[0]+"</span>"):c?t.replace(/ERROR/i,'<span style="color: #FF0000;">'+c+"</span>"):t},doLock:function(){this.unlock?(this.content="解除锁定",this.ico="lock"):(this.content="锁定滚动条",this.ico="unlock"),this.unlock=!this.unlock}}},l=(n("aLp4"),n("KHd+")),f=Object(l.a)(u,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",style:"width:"+t.width},[n("el-row",[n("el-col",{attrs:{span:21}},[n("el-card",{staticClass:"box-card"},[n("el-tooltip",{staticClass:"closepage item",attrs:{content:"返回上一页",effect:"dark",placement:"left"}},[n("el-button",{attrs:{type:"info",size:"mini",circle:""},on:{click:t.closeTag}},[n("svg-icon",{attrs:{"icon-class":"return"}})],1)],1),t._v(" "),n("el-tooltip",{staticClass:"lock item",attrs:{content:t.content,effect:"dark",placement:"left"}},[n("el-button",{attrs:{type:"info",size:"mini",circle:""},on:{click:t.doLock}},[n("svg-icon",{attrs:{"icon-class":t.ico}})],1)],1),t._v(" "),n("div",{staticClass:"console",style:"height:"+t.height,attrs:{id:"console"}},[t._l(t.data,function(e){return n("div",{key:e.id},[n("span",{staticClass:"line-html",domProps:{innerHTML:t._s(e)}})])}),t._v(" "),n("div",{staticStyle:{"text-align":"center"}},[n("span",{directives:[{name:"loading",rawName:"v-loading",value:6!=t.sequence,expression:"sequence == 6 ? false : true"}],attrs:{"element-loading-spinner":"el-icon-loading"}})])],2)],1)],1),t._v(" "),n("el-col",{attrs:{span:3}},[n("el-card",{staticClass:"box-card"},[n("div",{style:"height:"+t.height},[n("el-steps",{attrs:{active:t.sequence,direction:"vertical","finish-status":"success","align-center":""}},[n("el-step",{attrs:{title:"检出前置"}}),t._v(" "),n("el-step",{attrs:{title:"检出代码"}}),t._v(" "),n("el-step",{attrs:{title:"检出后置"}}),t._v(" "),n("el-step",{attrs:{title:"部署前置"}}),t._v(" "),n("el-step",{attrs:{title:"部署"}}),t._v(" "),n("el-step",{attrs:{title:"部署后置"}})],1)],1)])],1)],1)],1)},[],!1,null,null,null);e.default=f.exports},7850:function(t,e,n){},Qdvm:function(t,e,n){"use strict";n.d(e,"c",function(){return i}),n.d(e,"d",function(){return s}),n.d(e,"b",function(){return c}),n.d(e,"a",function(){return r});var o=n("t3Un");function i(t){return Object(o.a)({url:"api/deploy/excu/",method:"post",data:t})}function s(t){return Object(o.a)({url:"api/deploy/ver/?id="+t,method:"get"})}function c(t){return Object(o.a)({url:"api/deploy/applog/",method:"post",data:t})}function r(t){return Object(o.a)({url:"api/deploy/applog/",method:"post",data:t,responseType:"blob"})}},aLp4:function(t,e,n){"use strict";var o=n("7850");n.n(o).a},tAjd:function(t,e,n){"undefined"!=typeof self&&self,t.exports=function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.listeners=new Map}return o(t,[{key:"addListener",value:function(t,e,n){return"function"==typeof e&&(this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push({callback:e,vm:n}),!0)}},{key:"removeListener",value:function(t,e,n){var o=this.listeners.get(t),i=void 0;return!!(o&&o.length&&(i=o.reduce(function(t,o,i){return"function"==typeof o.callback&&o.callback===e&&o.vm===n&&(t=i),t},-1))>-1)&&(o.splice(i,1),this.listeners.set(t,o),!0)}},{key:"emit",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var i=this.listeners.get(t);return!(!i||!i.length||(i.forEach(function(t){var e;(e=t.callback).call.apply(e,[t.vm].concat(n))}),0))}}]),t}();e.default=new i},function(t,e,n){t.exports=n(2)},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),s=o(i),c=n(0),r=o(c);e.default={install:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("[vue-native-socket] cannot locate connection");var o=null;n.$setInstance=function(e){t.prototype.$socket=e},n.connectManually?(t.prototype.$connect=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;c.$setInstance=n.$setInstance,o=new s.default(i,c),t.prototype.$socket=o.WebSocket},t.prototype.$disconnect=function(){o&&o.reconnection&&(o.reconnection=!1),t.prototype.$socket&&(t.prototype.$socket.close(),delete t.prototype.$socket)}):(o=new s.default(e,n),t.prototype.$socket=o.WebSocket);var i="undefined"!=typeof Proxy&&"function"==typeof Proxy&&/native code/.test(Proxy.toString());t.mixin({created:function(){var t=this,e=this,n=this.$options.sockets;i?(this.$options.sockets=new Proxy({},{set:function(t,n,o){return r.default.addListener(n,o,e),t[n]=o,!0},deleteProperty:function(t,n){return r.default.removeListener(n,e.$options.sockets[n],e),delete t.key,!0}}),n&&Object.keys(n).forEach(function(e){t.$options.sockets[e]=n[e]})):(Object.seal(this.$options.sockets),n&&Object.keys(n).forEach(function(t){r.default.addListener(t,n[t],e)}))},beforeDestroy:function(){var t=this;if(i){var e=this.$options.sockets;e&&Object.keys(e).forEach(function(e){delete t.$options.sockets[e]})}}})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=n(0),s=function(t){return t&&t.__esModule?t:{default:t}}(i),c=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.format=n.format&&n.format.toLowerCase(),e.startsWith("//")&&(e=("https:"===window.location.protocol?"wss":"ws")+"://"+e),this.connectionUrl=e,this.opts=n,this.reconnection=this.opts.reconnection||!1,this.reconnectionAttempts=this.opts.reconnectionAttempts||1/0,this.reconnectionDelay=this.opts.reconnectionDelay||1e3,this.reconnectTimeoutId=0,this.reconnectionCount=0,this.passToStoreHandler=this.opts.passToStoreHandler||!1,this.connect(e,n),n.store&&(this.store=n.store),n.mutations&&(this.mutations=n.mutations),this.onEvent()}return o(t,[{key:"connect",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.protocol||"";return this.WebSocket=n.WebSocket||(""===o?new WebSocket(t):new WebSocket(t,o)),"json"===this.format&&("sendObj"in this.WebSocket||(this.WebSocket.sendObj=function(t){return e.WebSocket.send(JSON.stringify(t))})),this.WebSocket}},{key:"reconnect",value:function(){var t=this;this.reconnectionCount<=this.reconnectionAttempts?(this.reconnectionCount++,clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=setTimeout(function(){t.store&&t.passToStore("SOCKET_RECONNECT",t.reconnectionCount),t.connect(t.connectionUrl,t.opts),t.onEvent()},this.reconnectionDelay)):this.store&&this.passToStore("SOCKET_RECONNECT_ERROR",!0)}},{key:"onEvent",value:function(){var t=this;["onmessage","onclose","onerror","onopen"].forEach(function(e){t.WebSocket[e]=function(n){s.default.emit(e,n),t.store&&t.passToStore("SOCKET_"+e,n),t.reconnection&&"onopen"===e&&(t.opts.$setInstance(n.currentTarget),t.reconnectionCount=0),t.reconnection&&"onclose"===e&&t.reconnect()}})}},{key:"passToStore",value:function(t,e){this.passToStoreHandler?this.passToStoreHandler(t,e,this.defaultPassToStore.bind(this)):this.defaultPassToStore(t,e)}},{key:"defaultPassToStore",value:function(t,e){if(t.startsWith("SOCKET_")){var n="commit",o=t.toUpperCase(),i=e;"json"===this.format&&e.data&&((i=JSON.parse(e.data)).mutation?o=[i.namespace||"",i.mutation].filter(function(t){return!!t}).join("/"):i.action&&(n="dispatch",o=[i.namespace||"",i.action].filter(function(t){return!!t}).join("/"))),this.mutations&&(o=this.mutations[o]||o),this.store[n](o,i)}}}]),t}();e.default=c}])}}]);